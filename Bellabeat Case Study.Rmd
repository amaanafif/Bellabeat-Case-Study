---
title: "Bellabeat Case Study"
author: "Amaan Afif"
date: "09/13/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Case Study : How Can a Wellness Technology Company Play It Smart?

### 1. Summary

The goal of this case study is to analyze a business task following through all steps of the data analysis process: ask, prepare, process, analyze, share, and act. The main stakeholder is the Bellabeat executive team. Bellabeat is a high-tech manufacturer of health-focused products for women. The business task is to analyze smart device usage data to gain insight into how consumers are using their smart devices and provide high-level recommendations for Bellabeat’s marketing strategy. I will use the FitBit dataset that includes 30 days period device usage data from 30 FitBit users. The insights gained from the analysis are focused on the Bellabeat Leaf - a classic wellness tracker can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track activity, sleep, and stress.

### 2. Ask Phase

The problem that the Bellabeat company is trying to solve, is to unlock new growth opportunities. According to Grand View Research, the global fitness tracker market size was valued at USD 34.6 billion in 2020, USD 41.3 billion in 2021, and is expected to grow at a compound annual growth rate (CAGR) of 18.9% from 2021 to 2028. Some of the key players in the global fitness tracker market are: Apple, Inc., Fitbit, Inc., Garmin Ltd., Beienda, Ambiotex GmbH, Hexoskin, Huawei Technologies, Nurvv, Oura Health Ltd., Withings. Bellabeat is a successful small company, but they have the potential to become a larger player in the global smart device market. The business focuses on women’s health and wellness but its main product is the Bellabeat Leaf. The Leaf is a water-resistant device that tracks your activity, stress, sleep, meditation, and reproductive health. The data is then shared with the consumer to help her adjust diet, exercise and wellness based on her hormones and menstrual cycle. It is made of hypoallergenic, vegan-friendly materials and can be worn as a necklace, bracelet, or clip, depending on which accessories you combine with it. According to Forbes, within four years after its inception, Bellabeat has already sold over 700,000 pieces of jewelry. The Leaf price at the Bellabeat website is USD 89 - 99.

The key stakeholders are:

- Urška Sršen, a Slovenain artist and Bellabeat’s co-founder and Chief Creative Officer;
- Sandro Mur, a Croatian mathematician, Bellabeat’s co-founder, and key member of the Bellabeat executive team. The business task is to analyze smart device usage data in order to gain insight into how consumers use non-Bellabeat smart devices to help guide marketing strategy for the Bellabeat company.

### 3. Prepare Phase

FitBit Fitness Tracker Data (CC0: Public Domain, dataset made available through Mobius) is a zip archive of 18 csv files. These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 04.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences. All the files have unique names, there are no corrupted files or duplicates in the dataset. The files are in the wide format. The original dataset is stored here. The original dataset files come under Creative Commons Attribution 4.0 International license, the FitBit Fitness Tracker Data dataset files come under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication license. Individual reports are anonymized and use ID as an identifier, there is no personal information, so the data is private and secure. The possible problems with the data are:

- small sampling size of 30 participants and short observation period of 31 days - possible sampling bias;
- the data was recorded in 2016, it is not current and it might be outdated by now;
- there is no extra information about the respondents like at least age and gender but their device IDs. We still can use this data to analyze usage habits of the survey participants.

### 4. Process Phase

I explored the data in Excel first - the size of the files is acceptable for analysis in Excel. I created a few pivot tables to understand some top-level statistics and get primary information about the data. After this step I decided to analyze daily and hourly usage habits and exclude minute activities, heart rate and weight records from the analysis. Then I continued with R to show my analysis process step by step and create visualizations for the Share phase.

I imported the necessary R libraries and files from the data set to work with, and got some summary statistics about the data to understand its content, format and structure. I checked how many unique IDs we have in each data frame:

- 33 IDs for the steps, daily and hourly activity records;
- 24 IDs for the sleep activity records. All files have the same IDs which can be used for merging and joining data frames. Next I checked files for Na’s and duplicates. After that I split the date column into date and time columns and changed the format of the data in the columns and changed column names to lower case.
The last step - merge data frames by IDs to make further analysis more convenient. Finally I got two pre-cleaned data frames for analysis:

- data frame “daily” with 940 records and 18 columns - contains records about daily users activity;
- data frame “hourly” with 22 099 records and 5 columns - contains records about hourly users activity.

```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
library(janitor)
library(tidyr)
library(skimr)
library(ggplot2)
library(scales)
library(reshape2)
library(DataExplorer)
library(psych)
```

Read files.

```{r}
daily_activity <- read.csv("dailyActivity_merged.csv")
hourly_сalories <- read.csv("hourlyCalories_merged.csv")
hourly_intensities <- read.csv("hourlyIntensities_merged.csv")
hourly_steps <- read.csv("hourlySteps_merged.csv")
daily_sleep <- read.csv("sleepDay_merged.csv")
```

Check how our data looks like.

```{r}
head(daily_activity, 1)
head(hourly_сalories, 1)
head(hourly_intensities, 1)
head(hourly_steps, 1)
head(daily_sleep, 1)
```

Get information about the tables using glimpse function.

```{r}
glimpse(daily_activity)
glimpse(hourly_сalories)
glimpse(hourly_intensities)
glimpse(hourly_steps)
glimpse(daily_sleep)
```

Check how many distinct ID's in each data frame.

```{r}
n_distinct(daily_activity$Id)
n_distinct(hourly_сalories$Id)
n_distinct(hourly_intensities$Id)
n_distinct(hourly_steps$Id)
n_distinct(daily_sleep$Id)
```

There are more ID's that survey participants in daily activities and less ID's that survey participants in sleep records and weight records.

Check records for duplicates and Nulls.

```{r}
sum(duplicated(daily_activity))
sum(duplicated(hourly_сalories))
sum(duplicated(hourly_intensities))
sum(duplicated(hourly_steps))
sum(duplicated(daily_sleep))
```

Check for Nulls

```{r}
sum(is.na(daily_activity))
sum(is.na(hourly_сalories))
sum(is.na(hourly_intensities))
sum(is.na(hourly_steps))
sum(is.na(daily_sleep))
```

Remove duplicated records from daily_sleep data frame:

```{r}
daily_sleep <- daily_sleep %>%
  distinct() %>%
  drop_na()
```

Check that the duplicates are removed or not:

```{r}
sum(duplicated(daily_sleep))
```

Rename columns with dates in daily observation data frames to make column names consistent:

```{r}
daily_activity<- daily_activity %>% 
  rename(Date = ActivityDate)
daily_sleep<- daily_sleep %>% 
  rename(Date = SleepDay)
```

Fix column formatting - date columns are in character format now, need to convert them to the date-time format.

```{r}
daily_activity$Date = as.POSIXct(daily_activity$Date, format="%m/%d/%Y", tz = Sys.timezone())
daily_sleep$Date = as.POSIXct(daily_sleep$Date, format = "%m/%d/%Y", tz = Sys.timezone())
hourly_сalories$ActivityHour = as.POSIXct(hourly_сalories$ActivityHour, format = "%m/%d/%Y %I:%M:%S %p", tz = Sys.timezone())
hourly_intensities$ActivityHour = as.POSIXct(hourly_intensities$ActivityHour, format = "%m/%d/%Y %I:%M:%S %p", tz = Sys.timezone())
hourly_steps$ActivityHour = as.POSIXct(hourly_steps$ActivityHour, format = "%m/%d/%Y %I:%M:%S %p", tz = Sys.timezone())
```

Change column names to the lower case with clean_names():

```{r}
daily_activity <- clean_names(daily_activity)
hourly_сalories <- clean_names(hourly_сalories)
hourly_intensities <- clean_names(hourly_intensities)
hourly_steps <- clean_names(hourly_steps)
daily_sleep <- clean_names(daily_sleep)
```

Merging daily data frames and hourly data frames for further analysis. Hourly data frames have the same count of rows (22099 rows), merge them using inner join.

```{r}
hourly <- merge(hourly_сalories, hourly_steps, by = c ("id", "activity_hour")) %>% merge(hourly_intensities, by = c ("id", "activity_hour")) %>%
  separate(activity_hour, into = c("date", "time"), sep= " ") %>%
 mutate(date = ymd(date))  
glimpse(hourly)
```

Daily data frames have different count of rows, merge them using outer join to keep all rows.

```{r}
daily <- merge(daily_activity, daily_sleep, by = c ("id", "date"), all = TRUE) 
  glimpse(daily)
```

### 5. Analysis Phase

The data for the analysis is organized in two data frames. To make the analysis, I filtered data, reshaped it, made calculations, added new columns to the existing data frames, and removed columns from the existing data frames.

Explore daily activity data set first. Check how the values are distributed and analyze correlation in the data.

```{r}
# build density plot
daily %>%  plot_density(ncol = 6, ggtheme = theme_minimal())
options(repr.plot.width = 20, repr.plot.height = 10)
#build correlation plot
#corPlot(daily[,3:18], cex=0.4, cex.axis=0.6, xlas=2, upper=FALSE, scale=FALSE, main="Correlations in daily activity", select=(-c(2:8,14)))
corPlot(daily[,3:18], upper=FALSE, scale=FALSE, main="Correlations in daily activity", select=(-c(2:8,14)))
```

There is a positive correlation between total steps, active minutes and calories. And there is a stronger correlation between very active minutes and calories burnt. It might mean that users prefer walking and running as their activity. Whatever activity it is, this activity helps to burn calories more intensively. Also there is a negative correlation between sedentary minutes and sleep time. This need be investigated further because the data in the data set is limited and there is less sleep records than sedentary activity records. Another strong positive correlation is between time in bed and minutes asleep - it is an expected correlation between these variables. Check summary information about daily activity.

```{r}
daily %>%  
 select(total_steps,
        total_minutes_asleep,
        sedentary_minutes) %>%
  summary()
```

The first surprise in the data that I discovered:

- records with 0 total steps
- records with 1440 sedentary minutes, 1440 minutes = 24 hours (1440/60 = 24)
- records with 0 sedentary minutes. Let's check how many records have those values.

```{r}
sum(daily$total_steps == 0)
sum(daily$sedentary_minutes == 0)
sum(daily$sedentary_minutes == 1440)
```

Check how many days have 0 total steps and 1440 minutes of sedentary activity together.

```{r}
sum(daily$total_steps == 0 & daily$sedentary_minutes == 1440)
```

There are 72 records, which can reflect different reasons behind them, for example, the user did not wear the device that day or there was an error in tracking. I checked FitBit support forums and discovered that these tracking records can be considered as a bug. That's why I decided to filter these records out from the data frame.

```{r}
daily <- subset(daily, !(total_steps == 0 & sedentary_minutes == 1440))
glimpse(daily)
```

Now the daily data frame has 868 records and 18 columns.

Group the data by ID to check how many days users wore the devices during the observation period and check how many days the user wore their devices.

```{r}
daily_users <- daily %>%
group_by(id) %>%
summarise(days_in_use = sum(total_steps > 0))
summary(daily_users$days_in_use)
daily_users %>% group_by(days_in_use) %>% summarise(count = n())
```

I decided to split users into groups to check activity by groups: do the users who wear their devices daily have different habits from those who wear their devices from time to time? How many groups should we split users to and how to split them? I see some possible ways:

1. Three groups: group 1 - over 30 days, 14 IDs; group 2 - between 21 and 30 days (first quantile and median),11 IDs; group 3 - 21 days, 8 IDs.
2. Three groups: group 1 - over 30 days (the values above median), 14 IDs; group 2 - 30 days (median value), 6 IDs; group 3 - 29 days and less; 13 IDs (the values below median).
3. Two groups: group 1 - 30 - 31 days (median and above),20 IDs; group 2 - less than 30 days (below median), 13 IDs.
4. Two groups: group 1 - 31 days (mode), 14 IDs; group 2 - 30 days and less (median and below),19 IDs.
5. Two groups: group 1 - over 26 days (above mean value),21 IDs; group 2 - less than 26 days (below mean value), 12 IDs.

Using my basic knowledge of statistics and the density plot that is printed above, I finally decided to split user into 3 groups by median value:

- Group 1 - 31 days (the values above median), 14 IDs,
- Group 2 - 30 days (median value) - 6 IDs,
- Group 3 - 29 days and less - 13 IDs (the values below median).

```{r}
#split into 3 groups by median value: median, above median and below median - I will use this method in the analysis
daily_users_2 <- daily_users %>%
mutate(usage_frequency = case_when (days_in_use > 30 ~ "every day", days_in_use == 30 ~ "regularly", days_in_use < 30 ~ "sporadically",))
daily_users_2 %>% group_by(usage_frequency) %>% summarise(groups_by_median = n())
```

Check how many percents of users in each group:

```{r}
g1 <- daily_users_2 %>%
    group_by(usage_frequency) %>%
    summarise(users = n_distinct(id)) %>%
     ggplot(aes(x="", y=users, fill=usage_frequency)) + 
geom_bar(stat="identity", width=1, color="white") + 
coord_polar("y", start=0) + theme_void() + 
theme(legend.text = element_text(size=10), 
      legend.title = element_text(size=15),
      plot.title = element_text(size=20, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=15, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 50, 5, 100)) +
geom_text(aes(label = percent(users/sum(users))), position = position_stack(vjust = 0.5), color="white", size=5) + 
scale_fill_brewer(palette = "Set1", label = c(
    "14 IDs: 31 days in use", "6 IDs: 30 days in use", "13 IDs: < 30 days in use"))  + 
   labs(
    fill = "User Groups",
    title = "How Often Do Users Wear Their Trackers?", 
    subtitle = "User Groups by Days in Use" 
    )
print(g1)
```

Add usage frequency to the data frames with daily and hourly activities:

```{r}
daily_2 <- daily %>%
left_join(daily_users_2, by = "id") %>%
select(-days_in_use)
```

Check if there any difference in daily activity among the 3 groups:

```{r}
daily_2_summary <- daily_2 %>%
group_by(usage_frequency) %>%
summarise("Steps Taken, steps" = mean(total_steps), 
          "Calories Burnt, ccal" = mean(calories), 
          "Sleep Time, min" = mean(total_minutes_asleep, na.rm=TRUE), 
          "Time in Bed, min" = mean(total_time_in_bed, na.rm=TRUE), 
          "Sedentary Time, min" = mean(sedentary_minutes), 
          "Light Activity, min" = mean(lightly_active_minutes), 
          "Fair Activity, min" = mean(fairly_active_minutes), 
          "High Activity, min" = mean(very_active_minutes)) %>%
reshape2::melt (id=1, measure=c(2:9)) %>%
  group_by(variable) %>%
  mutate(percent_fmt = round(value/ sum(value), 3)) 

ggplot(daily_2_summary, aes(fill=usage_frequency, x=usage_frequency, y=value)) + 
geom_bar(position="stack", stat="identity") + 
theme_void() + 
theme(legend.text = element_text(size=8), 
      legend.title = element_text(size=10),
      plot.margin = margin(5, 100, 5, 100),
      strip.text = element_text(size=6, margin = margin(10, 10, 10, 10, "pt")),
    axis.text.x = element_text(
    size = 8,  hjust = 0.5, vjust = 0.5, angle = 90), 
      axis.text.y = element_text(size = 8, hjust = 1, vjust = 1)) + 
scale_fill_brewer(palette = "Set1") + facet_wrap( ~ variable, scale="free_y")
```

Analysis of daily activity by groups showed that the users from the Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) took more daily steps and had more active minutes during the observation period, and the users from the Group 3 (used the device for 3 - 29 days) showed slightly increased sedentary activity during the observation period.

```{r}
#create percent stacked bar plot
g2 <- ggplot(daily_2_summary, aes(fill=usage_frequency, y=value, x=variable)) + geom_bar(position="fill", stat="summary", fun="mean", color = "white", lwd = 0.25) + 
scale_y_continuous(labels = percent_format())  +
theme_void() + 
theme(legend.text = element_text(size=8), 
      legend.title = element_text(size=10),
      plot.title = element_text(size=10, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=10, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 50, 5, 50), 
      axis.title.y = element_text("Activity During a Day", size = 8, angle= 90, vjust=2), 
      axis.text.x = element_text(size = 8, angle = 0, hjust = 1, vjust = 1), 
      axis.text.y = element_text(size = 8, hjust = 1, vjust = 1)) + 
#guides(fill = guide_legend(reverse = TRUE)) +
scale_fill_brewer(breaks = rev, direction = -1, palette = "Set1", label = c("13 IDs: < 30 days in use", "6 IDs: 30 days in use", "14 IDs: 31 days in use"))  + coord_flip()  + scale_x_discrete(limits = rev(levels(daily_2_summary$variable))) + 
   labs(
    x = "Activity During a Day",
    fill = "User Groups",
    title = "What Kind of Activity Do Users Prefer?",
    subtitle = "Daily Activity by User Groups" 
    ) + geom_text(aes(label = percent(percent_fmt, accuracy=0.1)), position = position_fill(vjust=0.5), color="white", size=5)
print(g2)
```

The chart shows that the users who wore their devices more than 30 days, showed more physical activity during the observation period, and the users who wore their devices less than 30 days, took less steps and showed slightly increased sedentary activity during the observation period.

Let's check activity distribution by weekdays.

```{r}
weekdays_summary <- daily_2 %>%
  mutate(weekday = weekdays(date)) %>%
  group_by(weekday, usage_frequency) %>%
  summarise("Steps Taken, steps" = mean(total_steps), "Calories Burnt, ccal" = mean(calories), "Sleep Time, min" = mean(total_minutes_asleep, na.rm=TRUE), "Time in Bed, min" = mean(total_time_in_bed, na.rm=TRUE), "Sedentary Time, min" = mean(sedentary_minutes), "Light Activity, min" = mean(lightly_active_minutes), "Fair Activity, min" = mean(fairly_active_minutes), "High Activity, min" = mean(very_active_minutes), .groups = "drop") %>%
reshape2::melt(id=c(1:2), measure=c(3:10)) 
#faceted data
g3 <- ggplot(weekdays_summary, aes(fill=usage_frequency, y=value, x=factor(weekday, weekdays(as.Date('1970-01-03') + 1:7)))) + 
geom_bar(position="dodge", stat="summary", fun="mean", color = "white", lwd = 0.5) + 
theme_void() + 
theme(legend.text = element_text(size=8), 
      legend.title = element_text(size=10),
      plot.title = element_text(size=12, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=10, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 50, 5, 50),
    strip.text.x = element_text(size=8, margin = margin(3, 3, 3, 3, "pt")), 
      axis.text.x = element_text(size = 8, angle = 90, hjust = 1, vjust = 1), 
      axis.text.y = element_text(size = 5, hjust = 1, vjust = 1)) + 
facet_wrap(~ variable, scale="free_y", ncol=2) + 
scale_fill_brewer(palette = "Set1", label = c("14 IDs: 31 days in use", "6 IDs: 30 days in use", "13 IDs: < 30 days in use")) + 
   labs(
    fill = "User Groups",
    title = "Does Activity Depend on the Day of the Week?",
    subtitle = "Daily Activity by User Groups and Days of the Week" 
    )
print(g3)

```

The most popular kind of activity during the day among all groups of users is sedentary activity. Users from Group 3 (used the device for 3 - 29 days) have few very active minutes and have more sedentary minutes than the users from other groups. Users from Group 2 (used the device for 30 days) showed much more fairly active minutes every day than the users from other groups. It might mean that they are bike riders or and they use bikes every day, or they like to run. Users from all groups sleep more on Sundays. Users from Group 2 and Group 3 sleep less on Saturdays. We can conclude that the users from Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) are more active during the week than the users from Group 3 (used the device for 3 - 29 days).

Let's check how many steps per day take users in different groups.

```{r}
g4 <- daily_2 %>%
  group_by(id, usage_frequency) %>%
  summarise(total_steps = mean(total_steps), .groups = "drop") %>% 
  arrange(desc(total_steps)) %>%
  mutate(total_steps_f = case_when (total_steps > 10000 ~ "10K+ steps", between(total_steps, 8000, 10000) ~ "8 - 10K steps", between(total_steps, 6000, 8000) ~ "6 - 8K steps", total_steps < 6000 ~ "< 6K steps")) %>%
  mutate(total_steps_f = fct_relevel(total_steps_f,c("< 6K steps", "6 - 8K steps", "8 - 10K steps", "10K+ steps"))) %>%
  group_by(total_steps_f, usage_frequency) %>%
  summarise(count = n(), .groups = "drop") %>%
  ggplot(aes(y=count, x=usage_frequency, fill=total_steps_f)) +
  geom_bar(stat="identity", position="dodge", color = "white") + 
scale_fill_brewer(palette = "Set1", label = c("< 6K steps", "6 - 8K steps", "8 - 10K steps", "10K+ steps")) + 
   labs(
     y = "Count of Users",
     x = "User Group",
    fill = "Steps per Day",
    title = "Do the Users Take More Steps if They Wear the Tracker Every Day?",
    subtitle = "Steps per Day by User Groups" 
    ) + 
theme_light() + 
theme(legend.text = element_text(size=8), 
      legend.title = element_text(size=10),
      plot.title = element_text(size=12, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=10, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 100, 5, 100),
      axis.title.x = element_text(size = 8),
      axis.title.y = element_text(size = 8, angle= 90),
     axis.text.x = element_text(size =5, hjust = 0.5, vjust = 1), 
      axis.text.y = element_text(size = 10, hjust = 1, vjust = 1)) +
scale_x_discrete(label = c("14 IDs: 31 days in use", "6 IDs: 30 days in use", "13 IDs: < 30 days in use")) #+ theme(strip.text.x = element_text(margin = margin(3, 3, 3, 3, "pt")), axis.text.x = element_text(size = 8, angle = 90, hjust = 1, vjust = 1), axis.text.y = element_text(size = 8, hjust = 1, vjust = 1))
print(g4)
```

Users from the Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) are tend to walk more than 10,000 steps per day: 6 IDs in total from the Group 1 and from the Group 2 took more than 10,000 steps per day, and 1 ID from the Group 3 took more than 10,000 steps per day. 10 IDs from Group 1 and 6 IDs from Group 2 took over 6,000 steps per day, 7 IDs from Group 3 took over 6,000 steps per day. We can assume that regular wearing of tracking can help users to monitor daily activity and prompt them to take more steps per day. On the other hand, users who take more steps per day, might be more motivated to use fitness trackers to monitor their activity. Thus, regular wearing a fitness tracker can result in increases in physical activity.

Check hourly activity distribution.

```{r}
corPlot(hourly[,4:7], upper=FALSE, scale=TRUE, main="Correlations in hourly activity")
```

There is a strong positive correlation between intensity, calories burnt and total steps. Check how many hours during the day user wear the device.

```{r}
hourly_2 <- hourly %>%
left_join(daily_users_2, by = "id") %>%
select(-days_in_use)
hourly_2 <- hourly_2 %>%
  mutate(weekday = weekdays(date)) %>%
  separate(time, into = c("hour", "minute", "second"), sep= ":") %>% select(-minute,-second) %>%
mutate_if(is.character, str_replace, pattern = '^0', replacement = '') %>%
mutate(hour = as.integer(hour)) %>%
mutate(hour = replace(hour,is.na(hour),0))

g5 <- hourly_2 %>% add_count(id, date, name = "hours_in_use") %>%
  group_by(usage_frequency) %>%
  summarise(hours_in_use = mean(hours_in_use), .groups = "drop") %>%
  ggplot(aes(fill=usage_frequency, x=hours_in_use, y="")) + 
geom_bar(stat = "identity", width=1, color="white")  + 
theme_void()  + 
theme(legend.text = element_text(size=15), 
      legend.title = element_text(size=20),
      plot.title = element_text(size=30, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=20, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 50, 5, 50)) +
coord_polar("x", start=0)  + 
geom_text(aes(label = paste0(formatC(hours_in_use), " hours")), position = position_stack(vjust = 0.5), color="white", size=4) + 
scale_fill_brewer(palette = "Set1", label = c("14 IDs: 31 days in use", "6 IDs: 30 days in use", "13 IDs: < 30 days in use"))  + 
   labs(
    fill = "User Groups",
    title = "How Many Hours per Day Do the Users Wear the Trackers?",
    subtitle = "Hours of Wearing per Day by User Group" 
    )
print(g5)

```

Users among all groups wore their devices during 24 hours a day.

Check the most active hours during the day.

```{r}
hours_summary <- reshape2::melt(hourly_2, id=c(3,8:9), measure=c(4:7))
hours_summary %>% group_by(hour) %>%
  summarise(value = mean(value), .groups = "drop") %>%
  ggplot(aes(x = hour, y= value)) +
  geom_bar(width = 0.9, stat = "summary", fun="mean", fill="#377eb8", colour="white", position="dodge") +
  theme_void() + theme(axis.text.x = element_text(size = 20,  hjust = 1, vjust = 1)) +
  scale_fill_brewer(palette = "Set1") +
  coord_polar(theta = "x", start = -.13, clip = "on") +
  scale_x_continuous(breaks = 0:24, expand = c(.001,0)) + scale_y_reverse() #+ ylim(190, 0)
```

The most active hours are 12:00 - 14:00 and 18:00 - 19:00.

Let's check hourly activity by groups.

```{r}
g6 <- hours_summary %>% group_by(hour, usage_frequency) %>%
  summarise(value = mean(value), .groups = "drop") %>%
  ggplot(aes(x = hour, y= value, fill=usage_frequency)) +
  geom_bar(width = 0.9, stat = "summary", fun="mean", colour="white", position="dodge") +
  theme_void()  + 
theme(legend.text = element_text(size=10), 
      legend.title = element_text(size=15),
      plot.title = element_text(size=20, margin = margin(10, 0, 0, 0, "pt")),
      plot.subtitle = element_text(size=15, margin = margin(10, 30, 30, 0, "pt")),
      plot.margin = margin(5, 50, 5, 50),
    strip.text = element_text(size=0), 
    legend.position = "bottom", axis.text.x = element_text(size = 10,  hjust = 1, vjust = 1)) +
  coord_polar(theta = "x", start = -.13)  +
  scale_x_continuous(breaks = 0:24, expand = c(.001,0)) + facet_grid(cols=vars(usage_frequency)) + scale_y_reverse() + scale_fill_brewer(palette = "Set1", label = c("14 IDs: 31 days in use", "6 IDs: 30 days in use", "13 IDs: < 30 days in use"))  + 
   labs(
    fill = "User Groups",
    title = "What Hours Are the Most Active During the Day?",
    subtitle = "Activity Hours per Day by User Group" 
    )
print(g6)
```

Users from the Group 1 (used the device for 31 days) showed two sets of active hours: 12:00 and 14:00 and the interval 16:00 - 19:00. Users from Group 2 (used the device for 30 days) are active at 13:00 and in the interval 17:00 - 19:00. Users from Group 3 (used the device for 3 - 29 days) are active in the morning at 8:00 and 11:00 and go to bed early. We can conclude that evening hours are the most busy hours of the users from Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days). Presumably the users prefer to do their exercises in the evening after work.

### 6. Share Phase

By the end of the analysis process I had some ideas regarding Bellabeat marketing strategy based on the gained insights. My data tells the story about different habits of the users who wear fitness trackers. My audience is a Bellabeat stakeholder Urška Sršen, Bellabeat’s co founder and Chief Creative Officer. The form of communication with the stakeholders is the final report. I created visualisations to share my findings and support my recommendations for Bellabeat marketing strategy. You can find all the visualisations in the final report at the Conclusion section.

### 7. Act Phase

The final conclusion is that because user habits are different, we need to use different kinds of advertisement messages to reach different users and make our marketing strategy successful. Suggested to segment users by usage frequency, and use different promotion strategies for each segment. The recommendations can be used during creation of the advertisement strategy, and also for deciding when and where to place company commercials. Next step is to explore Bellabeat Leaf usage statistics to confirm or disprove the insights gained by the current analysis, taking more information about a user into account: age, gender, employment status, region, health condition. I was not able to find strong correlation between steps taken during a day and the calories burnt. Also I discovered a negative correlation between sedentary minutes and sleep time. My hypothesis was that the people spend a lot of time in front of their screens and therefore they have a lack of sleep. The current data set has files with sleep records and weight records but information in those files is insufficient to make conclusions. That's why I would like to have additional information about sleep and weight records - it could help me to expand my findings. You can find marketing strategy recommendations in the final report at the Conclusion section.

### 8. Conclusion - Analysis Report

#### 1. Business task

Analyze smart device usage data in order to gain insight into how consumers use non-Bellabeat smart devices to help guide marketing strategy for the Bellabeat company.

#### 2. Data sources used for the analysis

FitBit Fitness Tracker Data (CC0: Public Domain, dataset made available through Mobius) These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 04.12.2016-05.12.2016. Thirty (30) eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

#### 3. Documentation of any cleaning or manipulation of data
1. Files loaded and read:
daily_activity <- read.csv("/cloud/project/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
hourly_сalories <- read.csv("/cloud/project/Fitabase Data 4.12.16-5.12.16/hourlyCalories_merged.csv")
hourly_intensities <- read.csv("/cloud/project/Fitabase Data 4.12.16-5.12.16/hourlyIntensities_merged.csv")
hourly_steps <- read.csv("/cloud/project/Fitabase Data 4.12.16-5.12.16/hourlySteps_merged.csv")
daily_sleep <- read.csv("/cloud/project/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
2. daily_sleep: removed 3 duplicated records.
3. daily_activity: column ActivityDate renamed to Date
4. daily_sleep: column SleepDay renamed to Date
5. daily_activity, daily_sleep: Date column - changed format to date
6. hourly_сalories, hourly_intensities, hourly_steps: ActivityHour column - changed format to date
7. daily_activity, daily_sleep, hourly_сalories, hourly_intensities, hourly_steps: changed column names to lower case and added underscores between words in the column names
8. hourly_сalories, hourly_intensities, hourly_steps: merged into a data frame "hourly" by columns "id", "activity_hour"
9. daily_activity, daily_sleep: merged into a data frame "daily" by columns "id", "date"
There are two pre-cleaned data frame for the analysis:
- dataframe "daily" with 940 records and 18 columns - contains records about daily users activity;
- dataframe "hourly" with 22 099 records and 5 columns - contains records about hourly users activity.

#### 4. Analysis summary
The respondents were divided into 3 groups by the amount of days they wore their devices during the survey:
- Group 1 - 31 days, 14 IDs,
- Group 2 - 30 days - 6 IDs,
- Group 3 - 29 days and less - 13 IDs.
Analysis of correlations between daily activities showed a positive correlation between total steps, active minutes and calories.
And there is a stronger correlation between very active minutes and calories burnt. It might mean that users prefer walking and running as their activity. Whatever activity it is, this activity helps to burn calories more intensively.
Also there is a negative correlation between sedentary minutes and sleep time. This needs to be investigated further because the data in the data set is limited and there are less sleep records than sedentary activity records.
Another strong positive correlation is between time in bed and minutes asleep - it is an expected correlation between these variables.

Analysis of daily activity by groups showed that the users from the Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) took more daily steps and had more active minutes during the observation period, and the users from the Group 3 (used the device for 3 - 29 days) showed slightly increased sedentary activity during the observation period.

The most popular kind of activity during the day among all groups of users is sedentary activity.
Users from Group 3 (used the device for 3 - 29 days) have few very active minutes and have more sedentary minutes than the users from other groups.
Users from Group 2 (used the device for 30 days) showed more fairly active minutes every day than the users from other groups.
It might mean that they are bike riders and they use bikes every day because their daily steps are not much higher than steps taken by the users from other groups.
Users from all groups sleep more on Sundays. Users from Group 2 and Group 3 sleep less on Saturdays.

We can conclude that the users from Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) are more active during the week than the users from Group 3 (used the device for 3 - 29 days). 
This conclusion is also confirmed by the analysis of how many steps per day users take in different groups.

Users from the Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days) are tend to walk more than 10,000 steps per day: 6 IDs in total from the Group 1 and from the Group 2 took more than 10,000 steps per day, and 1 ID from the Group 3 took more than 10,000 steps per day.
10 IDs from Group 1 and 6 IDs from Group 2 took over 6,000 steps per day, 7 IDs from Group 3 took over 6,000 steps per day.
We can assume that regular wearing of tracking can help users to monitor daily activity and prompt them to take more steps per day.
On the other hand, users who take more steps per day, might be more motivated to use fitness trackers to monitor their activity.
Thus, regular wearing a fitness tracker can result in increases in physical activity.

Analysis of correlations between hourly activities showed a strong positive correlation between intensity, calories burnt and total steps.
Using hourly records, we discovered that the users among all groups wore their devices during 24 hours a day.
Users from the Group 1 (used the device for 31 days) showed two sets of active hours: 12:00 and 14:00 and the interval 16:00 - 19:00.
Users from Group 2 (used the device for 30 days) are active at 13:00 and in the interval 17:00 - 19:00.
Users from Group 3 (used the device for 3 - 29 days) are active in the morning at 8:00 and 11:00 and go to bed early.

We can conclude that evening hours are the most busy hours of the users from Group 1 (used the device for 31 days) and Group 2 (used the device for 30 days).
Presumably the users prefer to do their exercises in the evening after work.

#### 5. Visualisations and key finding

```{r,echo = FALSE}
print(g1)
print("The respondents were divided into 3 groups by the amount of days they wore their devices.")
print(g2)
print(g3)
print(g4)
print("Regular wearing a fitness tracker can result in increases in physical activity.")
print(g5)
print(g6)
print("The hours can be used for ads time adjustment.")
```

### 6. Top high-level insights and recommendations
The analysis has revealed two groups of people:

- users who wear fitness trackers every day, are more motivated to monitor their activity and more physically active during the day;

- users who wear fitness trackers from time to time, are less motivated to monitor their activity and less physically active during the day. I suggest using different key messages for each group.
Motivated users already know about trackers and why they should use them - they already have an established need. These users can be referred to as "warm".

**The key message for the motivated users**: explain why they should choose Bella Leaf fitness tracker. We can tell them about Leaf advantages and features.
As this group is already familiar with usual bracelet-style fitness trackers, they will probably appreciate new types and designs, for example Leaf ring.
Leaf rings can be made as a waterproof ring that is convenient to use during any activities like swimming.

Bellabeat commercials can be located near the activity places of this group - parks, bike lanes, fitness clubs, etc.
Video ads can be shown at the activity places at the time of the most activity of these users. PPC ads like Google Adwords can be targeted for the less active hours. Content marketing can include articles with comparison of different models of fitness trackers, highlighting differences of Leaf from other trackers: Leaf trackers are fashionable and have many ways to wear them. Sponsorship of local sports events, like marathons can help to create connections between the brand and community.

The most loyal customers can become brand ambassadors and share their story with the audience - the ambassadors can be a bridge between motivated users and less motivated users.

Under-motivated users do not have a strong established need - we can call them "cold". **The key message for the under-motivated users**: explain why they need to monitor their activity and how fitness trackers can help to do it. The main focus is not Bellabeat trackers but users health and wellbeing.
PPC ads like Google Adwords are not the best choice for this user group.
The main marketing tools for this group of users are content marketing and event marketing:

- expert articles about fitness trackers and their advantages, motivational success stories, articles for women who need to track their cycle, etc.
- taking part in or organizing events and meetings about healthy lifestyle, etc.
- work with influencers and celebrities can help to promote healthy lifestyle and increase brand awareness.
- sponsorship of local events for women can establish a primary interest in the brand.

**Next steps in developing marketing strategy:**

- Improve user segmentation based on user's activity type (light, fair, very active, sedentary) to create more personal and targeted ads
- Analyze current advertisement channels and optimize them using insights about users' habits.
- Consider new advertisement places to reach users.
- Analyze advertisement companies by display time and consider adjustment in accordance with activity time from the analysis.
- Analyze expediency of segmentation the marketing company by the product features (users can be motivated and educated about certain features of the device and might not know about the other features).

It is my very first project on R. 
I would like to give credits to [Stackoverflow](https://stackoverflow.com/) for help with the code, [R Graph Gallery](https://www.r-graph-gallery.com/ggplot2-package.html) and [R Charts](https://r-charts.com/ggplot2/) for visualisation ideas and tutorials, peers [Suong Fiori](https://www.kaggle.com/mimosabella/fitness-tracker-a-usage-trends-analysis-with-r/notebook) and [Anastasiia Chebotina](https://www.kaggle.com/chebotinaa/bellabeat-case-study-with-r) for analysis ideas, and [Coursera and Google](https://www.coursera.org/learn/google-data-analytics-capstone/home/welcome) for the Data Analysis course.